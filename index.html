<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ølendle</title>
  <style>
    html, body { height:100%; margin:0; }
    body {
      font-family: sans-serif;
      background:
        linear-gradient(rgba(0,0,0,0.5),rgba(0,0,0,0.5)),
        url('background.jpg') center/cover no-repeat;
      background-size: cover;
      color: #fff;
      text-align: center;
    }
    main {
      position: relative;
      max-width: 900px;
      margin: 2rem auto;
      background: rgba(255,255,255,0.1);
      padding: 1rem;
      border-radius: 8px;
    }
    h1 { margin:0; font-size:3rem; }
    .mode {
      display: block;
      color: #8be88c;
      font-size: 2.5rem;
      margin-top: 0.25rem;
    }
    .mode.daily { color: #8be88c; } /* green for Daily */
    .byline { font-size:0.9rem; opacity:0.8; margin:0.5rem 0 1rem; }
    #winCounter { margin-bottom:1rem; }

    .autocomplete { position:relative; width:60%; margin:auto; }
    #guessInput {
      width:100%; padding:0.5rem; font-size:1rem;
      border:none; border-radius:4px; box-sizing:border-box;
    }
    #suggestions {
      position:absolute; top:100%; left:0; width:100%;
      max-height:200px; overflow-y:auto;
      background:#fff; color:#000; border-radius:4px;
      display:none; z-index:10;
    }
    .suggestion { display:flex; align-items:center; padding:0.25rem; cursor:pointer; }
    .suggestion:hover { background:#eee; }
    .suggestion img {
      width:40px; height:40px; object-fit:cover; border-radius:50%; margin-right:0.5rem;
    }

    button {
      display:block; width:60%; margin:0.5rem auto;
      padding:0.5rem; font-size:1rem;
      border:none; border-radius:4px; cursor:pointer;
    }
    button:disabled { opacity:0.5; cursor:not-allowed; }
    button:hover:not(:disabled) { background:rgba(255,255,255,0.2); }

    #hintBox {
      width:60%; margin:1rem auto; padding:0.5rem 1rem;
      background:rgba(200,200,200,0.4); color:#000;
      border-radius:4px; cursor:default;
    }
    #hintBox.active { background:#fff; cursor:pointer; }
    #hintReveal { margin-top:0.5rem; }

    .table-wrapper { overflow-x:auto; margin-top:1rem; }
    table {
      width:100%; min-width:700px; border-collapse:collapse;
      background:rgba(255,255,255,0.1);
    }
    th, td {
      padding:0.5rem; color:#fff; white-space:nowrap;
      border:1px solid rgba(255,255,255,0.3);
    }
    th { background:rgba(255,255,255,0.2); }
    .green  { background:rgba(136,232,140,0.7); color:#fff; }
    .yellow { background:rgba(254,240,138,0.7); color:#333; }
    .gray   { background:rgba(221,221,221,0.7); color:#333; }
    .winner-row td { background:rgba(136,232,140,0.7) !important; color:#fff !important; }
    img.person-photo {
      width:60px; height:60px; object-fit:cover; border-radius:50%;
    }

    @media (max-width:600px) {
      .autocomplete, button, #hintBox { width:100%; }
      table { min-width:500px; }
      img.person-photo { width:50px; height:50px; }
    }

    #winOverlay {
      position:fixed; top:0; left:0; right:0; bottom:0;
      background:rgba(0,0,0,0.8);
      display:flex; align-items:center; justify-content:center;
      opacity:0; pointer-events:none; transition:opacity 0.5s;
    }
    #winOverlay.show { opacity:1; pointer-events:auto; }
    #winContent {
      position:relative; background:rgba(50,50,50,0.95);
      color:#fff; padding:2rem; border-radius:8px; text-align:center;
      max-width:90%;
    }
    #winClose {
      position:absolute; top:8px; right:12px;
      font-size:1.5rem; cursor:pointer; color:#fff;
    }
    #winContent img {
      width:150px; height:150px; border-radius:50%;
      object-fit:cover; border:2px solid #fff;
    }
    #winContent h2 { margin:1rem 0; }
    #winContent p  { margin-top:0.5rem; font-size:1.2rem; }
  </style>
</head>
<body>
  <main>
    <h1>Ølendle</h1>
    <span class="mode daily">Daily</span>
    <div class="byline">By Morten</div>
    <div id="winCounter">Total Wins: <span id="winTotal">0</span></div>

    <div id="hintBox">Residence hint in <span id="hintCount">5</span> guesses</div>
    <div id="hintReveal"></div>

    <div class="autocomplete">
      <input id="guessInput" placeholder="Type a name…" autocomplete="off" />
      <div id="suggestions"></div>
    </div>
    <button id="guessBtn">Guess</button>

    <div class="table-wrapper">
      <table id="board">
        <thead>
          <tr>
            <th></th><th>Name</th><th>Birth Year</th><th>Height (cm)</th>
            <th>Residence</th><th>Hair Color</th><th>Gender</th><th>Eye Color</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>

  <div id="winOverlay">
    <div id="winContent">
      <div id="winClose">×</div>
      <h2>Today’s Ølendle was <span id="winName"></span></h2>
      <img id="winPhoto" src="" alt="">
      <p>You got it in <span id="winCount"></span> guesses!</p>
    </div>
  </div>

  <script>
    const DAY_MS = 24*60*60*1000;
    const KEYS = {
      DAY:   'olendle-date',
      G:     'olendle-guesses',
      H:     'olendle-hint',
      W:     'olendle-won',
      T:     'olendle-totalWins'
    };
    const placeholder = 'no-image.png';
    const people = [
      /* … same people array … */
    ];

    function initDay(){
      const now = Math.floor(Date.now()/DAY_MS);
      if (parseInt(localStorage.getItem(KEYS.DAY),10)!==now){
        localStorage.setItem(KEYS.DAY,now);
        localStorage.setItem(KEYS.G,JSON.stringify([]));
        localStorage.setItem(KEYS.H,'5');
        localStorage.removeItem(KEYS.W);
      }
      return now;
    }
    const today     = initDay();
    let guesses     = JSON.parse(localStorage.getItem(KEYS.G))||[];
    let hintCount   = parseInt(localStorage.getItem(KEYS.H),10)||5;
    let wonToday    = localStorage.getItem(KEYS.W)==='true';
    let totalWins   = parseInt(localStorage.getItem(KEYS.T),10)||0;
    const secret    = people[today % people.length];

    // elements
    const input     = document.getElementById('guessInput'),
          btn       = document.getElementById('guessBtn'),
          suggBox   = document.getElementById('suggestions'),
          tbody     = document.querySelector('#board tbody'),
          hintBox   = document.getElementById('hintBox'),
          hintRev   = document.getElementById('hintReveal'),
          winOvl    = document.getElementById('winOverlay'),
          winClose  = document.getElementById('winClose'),
          winName   = document.getElementById('winName'),
          winPhoto  = document.getElementById('winPhoto'),
          winCount  = document.getElementById('winCount'),
          winTotal  = document.getElementById('winTotal');

    winTotal.textContent = totalWins;

    // build table from saved guesses
    function renderRows(){
      tbody.innerHTML = '';
      guesses.forEach(name => {
        const p = people.find(x=>x.name===name);
        if (!p) return;
        const tr = document.createElement('tr');
        if (p.name === secret.name) tr.classList.add('winner-row');

        // photo
        tr.appendChild(cell(`<img class="person-photo" src="${p.imageUrl||placeholder}">`));
        // name
        tr.appendChild(cell(p.name));
        // numeric
        tr.appendChild(cell(compareNum(p.birthYear,secret.birthYear)));
        tr.appendChild(cell(compareNum(p.height,secret.height)));
        // categorical
        tr.appendChild(cell(compareCat(p.residence,secret.residence)));
        tr.appendChild(cell(compareCat(p.hairColor,secret.hairColor)));
        tr.appendChild(cell(compareCat(p.gender,secret.gender)));
        tr.appendChild(cell(compareCat(p.eyeColor,secret.eyeColor)));

        tbody.appendChild(tr);
      });
      disableAfterWin();
    }

    function compareNum(v,s){
      if (s===0) return `${v} ↓`;
      if (v===s) return `<span class="green">${v}</span>`;
      return `<span class="yellow">${v} ${v<s?'↑':'↓'}</span>`;
    }
    function compareCat(v,s){
      if (s==='Unknown') return `<span class="yellow">${v} ↓</span>`;
      if (v===s) return `<span class="green">${v}</span>`;
      return `<span class="gray">${v}</span>`;
    }

    function processGuess(name){
      const p = people.find(x=>x.name.toLowerCase()===name.toLowerCase());
      if (!p || guesses.includes(p.name)) return;
      guesses.unshift(p.name);
      localStorage.setItem(KEYS.G, JSON.stringify(guesses));
      if (secret.residence!=='Unknown'&& hintCount>0){
        hintCount--; localStorage.setItem(KEYS.H, hintCount);
      }
      if (p.name===secret.name && !wonToday){
        wonToday=true;
        localStorage.setItem(KEYS.W,'true');
        totalWins++;
        localStorage.setItem(KEYS.T,totalWins);
      }
      renderRows(); updateHint();
      if (p.name===secret.name) showWin(p.name,p.imageUrl,guesses.length);
    }

    function submitGuess(){
      const v = input.value.trim();
      if (!v) return;
      processGuess(v);
      input.value=''; input.focus();
    }
    btn.addEventListener('click',submitGuess);
    input.addEventListener('keydown',e=>{ if(e.key==='Enter') submitGuess(); });

    // autocomplete
    input.addEventListener('input',()=>{
      const val = input.value.trim().toLowerCase();
      suggBox.innerHTML='';
      if (!val) { suggBox.style.display='none'; return; }
      const matches = people
        .filter(x=>x.name.toLowerCase().includes(val))
        .filter(x=>!guesses.includes(x.name));
      if (!matches.length) { suggBox.style.display='none'; return; }
      matches.forEach(p=>{
        const d = document.createElement('div');
        d.className = 'suggestion';
        d.innerHTML = `<img src="${p.imageUrl||placeholder}"><span>${p.name}</span>`;
        d.onclick = ()=>{ input.value=p.name; suggBox.style.display='none'; input.focus(); };
        suggBox.appendChild(d);
      });
      suggBox.style.display='block';
    });
    input.addEventListener('blur',()=>setTimeout(()=>suggBox.style.display='none',100));

    // hint
    function updateHint(){
      if (hintCount>0){
        hintBox.classList.remove('active');
        hintBox.innerHTML = `Residence hint in <b>${hintCount}</b> guesses`;
      } else {
        hintBox.classList.add('active');
        hintBox.textContent = 'Show Hint';
      }
    }
    hintBox.onclick = ()=>{
      if (hintCount===0){
        hintBox.style.display='none';
        hintRev.textContent = 'Residence: '+secret.residence;
      }
    };

    // win overlay
    function showWin(name,img,count){
      winName.textContent = name;
      winPhoto.src = img||placeholder;
      winCount.textContent = count;
      winTotal.textContent = totalWins;
      winOverlay.classList.add('show');
      disableAfterWin();
    }
    winClose.onclick = ()=>{ winOverlay.classList.remove('show'); };

    function disableAfterWin(){
      if (wonToday){
        input.disabled = true;
        btn.disabled   = true;
      }
    }

    function cell(innerHTML){
      const td = document.createElement('td');
      td.innerHTML = innerHTML;
      return td;
    }

    // initial render
    renderRows();
  </script>
</body>
</html>
