<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ølendle</title>
  <style>
    html, body { height:100%; margin:0; }
    body {
      font-family: sans-serif;
      background:
        linear-gradient(rgba(0,0,0,0.5),rgba(0,0,0,0.5)),
        url('background.jpg') center/cover no-repeat;
      background-size: cover;
      color: #fff;
      text-align: center;
    }
    main {
      position: relative;
      max-width: 900px;
      margin: 2rem auto;
      background: rgba(255,255,255,0.1);
      padding: 1rem;
      border-radius: 8px;
    }
    #modeToggle {
      position: absolute;
      top: 1rem;
      right: 1rem;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      color: #fff;
      font-size: 0.9rem;
    }
    #modeToggle.daily { background: #4caf50; }   /* green */
    #modeToggle.free  { background: #9c27b0; }   /* purple */
    h1 { margin: 0; font-size: 3rem; }
    .mode {
      display: block;
      margin-top: 0.25rem;
      font-size: 2.5rem;
    }
    .mode.daily { color: #4caf50; }
    .mode.free  { color: #9c27b0; }
    .byline { font-size: 0.9rem; opacity: 0.8; margin: 0.5rem 0 1rem; }
    #winCounter { margin-bottom: 1rem; font-size: 1rem; }

    .input-group {
      display: flex;
      width: 60%;
      margin: 0 auto;
      position: relative;
    }
    #guessInput {
      flex: 1;
      padding: 0.75rem;
      font-size: 1rem;
      border: none;
      border-radius: 4px 0 0 4px;
      box-sizing: border-box;
    }
    #guessBtn {
      padding: 0 1rem;
      font-size: 1rem;
      border: none;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
    }
    #guessBtn:disabled { opacity: 0.5; cursor: not-allowed; }

    #suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      max-height: 200px;
      overflow-y: auto;
      background: #fff;
      color: #000;
      border-radius: 4px;
      display: none;
      z-index: 10;
    }
    .suggestion {
      display: flex;
      align-items: center;
      padding: 0.25rem;
      cursor: pointer;
    }
    .suggestion:hover { background: #eee; }
    .suggestion img {
      width: 40px; height: 40px; object-fit: cover;
      border-radius: 50%; margin-right: 0.5rem;
    }

    #hintBox {
      width: 60%;
      margin: 1rem auto;
      padding: 0.5rem 1rem;
      background: rgba(200,200,200,0.4);
      color: #000;
      border-radius: 4px;
      cursor: default;
    }
    #hintBox.active { background: #fff; cursor: pointer; }
    #hintReveal { margin-top: 0.5rem; }

    .table-wrapper { overflow-x: auto; margin-top: 1rem; }
    table {
      width: 100%;
      min-width: 700px;
      border-collapse: collapse;
      background: rgba(255,255,255,0.1);
    }
    th, td {
      padding: 0.5rem;
      color: #fff;
      white-space: nowrap;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.1);
    }
    th { background: rgba(255,255,255,0.2); }
    .green  { background: rgba(136,232,140,0.7) !important; color: #fff; }
    .yellow { background: rgba(254,240,138,0.7); color: #333; }
    .gray   { background: rgba(221,221,221,0.7); color: #333; }
    .winner-row td { background: rgba(136,232,140,0.7) !important; color: #fff !important; }
    img.person-photo {
      width: 60px; height: 60px; object-fit: cover; border-radius: 50%;
    }

    @media (max-width: 600px) {
      .input-group, #hintBox { width: 100%; }
      table { min-width: 500px; }
      img.person-photo { width: 50px; height: 50px; }
    }

    #winOverlay {
      position: fixed; top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.8);
      display:flex; align-items:center; justify-content:center;
      opacity: 0; pointer-events:none; transition:opacity 0.5s;
    }
    #winOverlay.show { opacity:1; pointer-events:auto; }
    #winContent {
      position: relative;
      background: rgba(50,50,50,0.95);
      color: #fff;
      padding: 2rem;
      border-radius: 8px;
      text-align: center;
      max-width: 90%;
    }
    #winClose {
      position: absolute; top:8px; right:12px;
      font-size:1.5rem; cursor:pointer; color:#fff;
    }
    #winContent img {
      width:150px; height:150px; border-radius:50%;
      object-fit:cover; border:2px solid #fff;
    }
    #winContent h2 { margin:1rem 0; }
    #winContent p  { margin-top:0.5rem; font-size:1.2rem; }
  </style>
</head>
<body>
  <main>
    <button id="modeToggle" class="daily">Freeplay</button>
    <h1>Ølendle</h1>
    <span id="modeLabel" class="mode daily">Daily</span>
    <div class="byline">By Morten</div>
    <div id="winCounter">Total Wins: <span id="winTotal">0</span></div>

    <div id="hintBox">Residence hint in <span id="hintCount">5</span> guesses</div>
    <div id="hintReveal"></div>

    <div class="autocomplete input-group">
      <input id="guessInput" placeholder="Type a name…" autocomplete="off" />
      <button id="guessBtn">Guess</button>
      <div id="suggestions"></div>
    </div>

    <div class="table-wrapper">
      <table id="board">
        <thead>
          <tr>
            <th></th><th>Name</th><th>Birth Year</th><th>Height</th>
            <th>Residence</th><th>Hair Color</th><th>Gender</th><th>Eye Color</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>

  <div id="winOverlay">
    <div id="winContent">
      <div id="winClose">×</div>
      <h2>Ølendle <span id="winMode"></span> Answer</h2>
      <h2><span id="winName"></span></h2>
      <img id="winPhoto" src="" alt="">
      <p>You got it in <span id="winCount"></span> guesses!</p>
    </div>
  </div>

  <script>
    // get Oslo local date
    function osloNow() {
      return new Date(new Date().toLocaleString("en-US",{timeZone:"Europe/Oslo"}));
    }
    const DAY_MS = 24*60*60*1000;
    const KEYS = {
      daily: { day:"day-d", guesses:"g-d", hint:"h-d", won:"w-d", total:"t-d" },
      free:  { day:"day-f", guesses:"g-f", hint:"h-f", won:"w-f", total:"t-f" }
    };

    const people = [
      { name:'Morten', birthYear:2008,height:182,residence:'Ølen', hairColor:'Brown',eyeColor:'Blue', gender:'M',imageUrl:'Morten.jpeg' },
      { name:'Thomas Andre', birthYear:2008,height:190,residence:'Ølensvåg', hairColor:'Brown',eyeColor:'Brown',gender:'M',imageUrl:'Thomas_Andre.jpg' },
      { name:'Eirik', birthYear:2008,height:176,residence:'Ølen', hairColor:'Blonde',eyeColor:'Blue', gender:'M',imageUrl:'Eirik.jpg' },
      { name:'Sasha', birthYear:2008,height:182,residence:'Haugesund', hairColor:'Brown',eyeColor:'Blue', gender:'M',imageUrl:'Sasha.jpg' },
      { name:'Dan Evan', birthYear:2008,height:180,residence:'Ølensvåg', hairColor:'Black',eyeColor:'Brown',gender:'M',imageUrl:'Dan_Evan.jpg' },
      { name:'Endre', birthYear:2008,height:182,residence:'Ølen', hairColor:'Blonde',eyeColor:'Blue', gender:'M',imageUrl:'Endre.jpg' },
      { name:'Gabri', birthYear:2007,height:182,residence:'Ølen', hairColor:'Blonde',eyeColor:'Blue', gender:'M',imageUrl:'Gabri.jpg' },
      { name:'Ridwan', birthYear:2007,height:194,residence:'Skjold', hairColor:'Black',eyeColor:'Brown',gender:'M',imageUrl:'Ridwan.jpg' },
      { name:'Sina', birthYear:2007,height:175,residence:'Ølen', hairColor:'Blonde',eyeColor:'Blue', gender:'F',imageUrl:'Sina.jpg' }
    ];

    // DOM refs
    const modeToggle = document.getElementById('modeToggle');
    const modeLabel  = document.getElementById('modeLabel');
    const winTotal   = document.getElementById('winTotal');
    const winMode    = document.getElementById('winMode');
    const guessInput = document.getElementById('guessInput');
    const guessBtn   = document.getElementById('guessBtn');
    const suggBox    = document.getElementById('suggestions');
    const tbody      = document.querySelector('#board tbody');
    const hintBox    = document.getElementById('hintBox');
    const hintReveal = document.getElementById('hintReveal');
    const winOverlay = document.getElementById('winOverlay');
    const winClose   = document.getElementById('winClose');
    const winName    = document.getElementById('winName');
    const winPhoto   = document.getElementById('winPhoto');
    const winCount   = document.getElementById('winCount');

    let mode = 'daily', today, guesses, hintCount, won, total, secret;

    function applyModeUI() {
      // toggle button
      modeToggle.textContent = mode==='daily' ? 'Freeplay' : 'Daily';
      modeToggle.className   = mode;
      // mode label
      modeLabel.textContent  = mode==='daily' ? 'Daily' : 'Freeplay';
      modeLabel.className    = 'mode ' + mode;
      winMode.textContent    = modeLabel.textContent;
    }

    function initState() {
      const dt  = osloNow();
      const day = Math.floor(dt.getTime()/DAY_MS);
      const k   = KEYS[mode];
      if (parseInt(localStorage.getItem(k.day),10)!==day) {
        localStorage.setItem(k.day, day);
        localStorage.setItem(k.guesses, '[]');
        localStorage.setItem(k.hint, '5');
        localStorage.removeItem(k.won);
      }
      today     = day;
      guesses   = JSON.parse(localStorage.getItem(k.guesses))||[];
      hintCount = parseInt(localStorage.getItem(k.hint),10)||5;
      won       = localStorage.getItem(k.won)==='true';
      total     = parseInt(localStorage.getItem(k.total),10)||0;
      // secret selection
      secret = mode==='daily'
        ? people[day % people.length]
        : people[Math.floor(Math.random()*people.length)];
      winTotal.textContent = total;
    }

    function saveState() {
      const k = KEYS[mode];
      localStorage.setItem(k.guesses, JSON.stringify(guesses));
      localStorage.setItem(k.hint, hintCount);
      localStorage.setItem(k.total, total);
      if (won) localStorage.setItem(k.won,'true');
    }

    function compareNum(v,s) {
      if (s===0)        return `${v} ↓`;
      if (v===s)        return `<span class="green">${v}</span>`;
      return `<span class="yellow">${v} ${v<s?'↑':'↓'}</span>`;
    }
    function compareCat(v,s) {
      if (s==='Unknown')return `<span class="yellow">${v} ↓</span>`;
      if (v===s)        return `<span class="green">${v}</span>`;
      return `<span class="gray">${v}</span>`;
    }

    function renderRows() {
      tbody.innerHTML = '';
      guesses.forEach(name=>{
        const p = people.find(x=>x.name===name);
        if (!p) return;
        const tr = document.createElement('tr');
        if (p.name===secret.name) tr.classList.add('winner-row');
        tr.appendChild(cell(`<img class="person-photo" src="${p.imageUrl||placeholder}">`));
        tr.appendChild(cell(p.name));
        tr.appendChild(cell(compareNum(p.birthYear,secret.birthYear)));
        tr.appendChild(cell(compareNum(p.height,secret.height)));
        tr.appendChild(cell(compareCat(p.residence,secret.residence)));
        tr.appendChild(cell(compareCat(p.hairColor,secret.hairColor)));
        tr.appendChild(cell(compareCat(p.gender,secret.gender)));
        tr.appendChild(cell(compareCat(p.eyeColor,secret.eyeColor)));
        tbody.appendChild(tr);
      });
      disableAfterWin();
    }

    function processGuess(val) {
      const p = people.find(x=>x.name.toLowerCase()===val.toLowerCase());
      if (!p || guesses.includes(p.name)) return;
      guesses.unshift(p.name);
      if (secret.residence!=='Unknown' && hintCount>0) hintCount--;
      if (p.name===secret.name && !won) {
        won = true;
        total++;
      }
      saveState();
      renderRows();
      updateHint();
      if (p.name===secret.name) showWin(p.name,p.imageUrl,guesses.length);
    }

    function submitGuess() {
      const v = guessInput.value.trim();
      if (!v) return;
      processGuess(v);
      guessInput.value=''; guessInput.focus();
    }

    guessBtn.addEventListener('click', submitGuess);
    guessInput.addEventListener('keydown', e=>{ if(e.key==='Enter') submitGuess(); });

    // autocomplete
    guessInput.addEventListener('input', ()=>{
      const v = guessInput.value.trim().toLowerCase();
      suggBox.innerHTML = '';
      if (!v) { suggBox.style.display='none'; return; }
      const matches = people
        .filter(x=>x.name.toLowerCase().includes(v))
        .filter(x=>!guesses.includes(x.name));
      if (!matches.length) { suggBox.style.display='none'; return; }
      matches.forEach(p=>{
        const d = document.createElement('div');
        d.className='suggestion';
        d.innerHTML = `<img src="${p.imageUrl||placeholder}"><span>${p.name}</span>`;
        d.onclick = ()=>{ guessInput.value=p.name; suggBox.style.display='none'; guessInput.focus(); };
        suggBox.appendChild(d);
      });
      suggBox.style.display='block';
    });
    guessInput.addEventListener('blur', ()=>setTimeout(()=>suggBox.style.display='none',100));

    // hint
    function updateHint(){
      if (hintCount>0){
        hintBox.classList.remove('active');
        hintBox.innerHTML = `Residence hint in <b>${hintCount}</b> guesses`;
      } else {
        hintBox.classList.add('active');
        hintBox.textContent = 'Show Hint';
      }
    }
    hintBox.onclick = ()=>{
      if (hintCount===0){
        hintBox.style.display='none';
        hintReveal.textContent = 'Residence: '+secret.residence;
      }
    };

    // win popup
    function showWin(name,img,count){
      winName.textContent = name;
      winPhoto.src = img||placeholder;
      winCount.textContent = count;
      winOverlay.classList.add('show');
      disableAfterWin();
    }
    winClose.onclick = ()=>{ winOverlay.classList.remove('show'); };

    function disableAfterWin(){
      if (won){
        guessInput.disabled = true;
        guessBtn.disabled   = true;
      }
    }

    function cell(innerHTML){
      const td = document.createElement('td');
      td.innerHTML = innerHTML;
      return td;
    }

    // initial bootstrap
    modeToggle.addEventListener('click', ()=>{
      mode = mode==='daily' ? 'free' : 'daily';
      applyModeUI();
      initState();
      renderRows();
      updateHint();
      disableAfterWin();
    });
    applyModeUI();
    initState();
    renderRows();
    updateHint();
    disableAfterWin();
  </script>
</body>
</html>
